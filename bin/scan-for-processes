#! /usr/bin/python -u
#
# Copyright 2009-2017 Canonical Ltd.  This software is licensed under the
# GNU Affero General Public License version 3 (see the file LICENSE).

"""Kill any processes running in a chroot."""

from __future__ import print_function

__metaclass__ = type

import os
import sys

from lpbuildd.target.kill_processes import KillProcesses


def main():
    # This whole script must run as root, since we want to iterate over
    # other users' processes in Python.
    if os.geteuid() != 0:
        cmd = ["sudo"]
        if "PYTHONPATH" in os.environ:
            cmd.append("PYTHONPATH=%s" % os.environ["PYTHONPATH"])
        cmd.append("--")
        cmd.extend(sys.argv)
        os.execv("/usr/bin/sudo", cmd)
    return KillProcesses().run()


if __name__ == "__main__":
    sys.exit(main())
