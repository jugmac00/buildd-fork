#! /usr/bin/python -u
#
# Copyright 2017 Canonical Ltd.  This software is licensed under the
# GNU Affero General Public License version 3 (see the file LICENSE).

"""Write out new trusted keys in the chroot.

Expects key material on stdin.
"""

from __future__ import print_function

__metaclass__ = type

from argparse import ArgumentParser
import sys

from lpbuildd.target.chroot import ChrootSetup


def main():
    parser = ArgumentParser(
        description="Write out new trusted keys in the chroot.")
    parser.add_argument(
        "build_id", metavar="ID", help="write trusted keys for build ID")
    args = parser.parse_args()

    print("Adding trusted keys to build-%s" % args.build_id)
    setup = ChrootSetup(args.build_id)
    setup.add_trusted_keys(sys.stdin)
    return 0


if __name__ == "__main__":
    sys.exit(main())
